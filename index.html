<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>热电偶计算器 - 网页版</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f0f0; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .section { margin-bottom: 20px; }
        label { margin-right: 10px; }
        input[type="number"] { width: 100%; padding: 8px; margin: 5px 0; box-sizing: border-box; }
        button { padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; width: 100%; }
        button:hover { background: #0056b3; }
        #result { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
        .material { color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>热电偶</h1>
        
        <div class="section">
            <h2>类型</h2>
            <label><input type="radio" name="type" value="R"> R型</label>
            <label><input type="radio" name="type" value="S"> S型</label>
            <label><input type="radio" name="type" value="B"> B型</label>
            <label><input type="radio" name="type" value="J" checked> J型</label>
            <label><input type="radio" name="type" value="T"> T型</label>
            <label><input type="radio" name="type" value="E"> E型</label>
            <label><input type="radio" name="type" value="K"> K型</label>
        </div>
        
        <div class="section">
            <h2>冷端补偿 (0~60°C)</h2>
            <input type="number" id="coldTemp" value="0" min="0" max="60" step="0.1">
        </div>
        
        <div class="section">
            <h2>温度 (范围根据类型)</h2>
            <input type="number" id="inputTemp" placeholder="输入温度计算电动势">
            <button onclick="calculateEmf()">输入温度计算电动势</button>
        </div>
        
        <div class="section">
            <h2>电动势 (范围根据类型, mV)</h2>
            <input type="number" id="inputEmf" placeholder="输入电动势计算温度" step="0.001">
            <button onclick="calculateTemp()">输入电动势计算温度</button>
        </div>
        
        <div id="result"></div>
    </div>
    
    <script>
        const materials = {
            R: { positive: '铂铑 (13%)', negative: '铂' },
            S: { positive: '铂铑 (10%)', negative: '铂' },
            B: { positive: '铂铑 (30%)', negative: '铂铑 (6%)' },
            J: { positive: '铁', negative: '康铜' },
            T: { positive: '铜', negative: '康铜' },
            E: { positive: '镍铬', negative: '康铜' },
            K: { positive: '镍铬', negative: '镍铝' }
        };

        const coefficients = {
            J: {
                direct: [ // μV
                    { range: [-210, 760], coeffs: [0.0, 50.3817688154, 3.0475836930e-1, -8.5681065723e-4, 1.3228195295e-6, -1.7052958337e-9, 2.0948090697e-12, -1.2538395336e-15, 1.5631549822e-19] },
                    { range: [760, 1200], coeffs: [-2016.325908, 38.1045566, -0.04559686, 1.0996880928e-4, -1.0013809125e-7, 4.6282346685e-11, -1.05275546e-14, 9.804036031e-19] }
                ],
                inverse: [ // mV to °C
                    { range: [-8.095, 0], coeffs: [0.0, 1.9528268e1, -1.2286185, -1.0752178, -5.9086933e-1, -1.7256713e-1, -2.8131513e-2, -2.3963370e-3, -8.3823321e-5] },
                    { range: [0, 42.919], coeffs: [0.0, 1.978425e1, -2.001204e-1, 1.036969e-2, -2.549687e-5, 3.585153e-6, -5.344285e-8, 5.099890e-10] },
                    { range: [42.919, 69.553], coeffs: [-3.11358187e3, 3.00543684e2, -9.94773230, 1.70276630e-1, -1.43033468e-3, 4.73886084e-6] }
                ],
                tempRange: [-210, 1200],
                emfRange: [-8.095, 69.553],
                tolerances: {
                    class1: (t) => {
                        if (t < -40 || t > 750) return 'N/A';
                        return t <= 375 ? 1.5 : 0.004 * Math.abs(t);
                    },
                    class2: (t) => {
                        if (t < -40 || t > 750) return 'N/A';
                        return t <= 333 ? 2.5 : 0.0075 * Math.abs(t);
                    },
                    class3: (t) => {
                        if (t < -200 || t > 40) return 'N/A';
                        return 2.5;
                    }
                }
            },
            K: {
                direct: [
                    { range: [-200, 0], coeffs: [0.0, 3.9450128025e1, 2.3622373598e-2, -3.2858906784e-4, -4.9904828777e-6, -6.7509059173e-8, -5.7410327428e-10, -3.1088872894e-12, -1.0451609365e-14, -1.9889266878e-17, -1.6322697486e-20] },
                    { range: [0, 500], coeffs: [-1.7600413686e1, 3.8921204975e1, 1.8558770032e-2, -9.9457592874e-5, 3.1840945719e-7, -5.6072844889e-10, 5.6075059059e-13, -3.2020720003e-16, 9.7151147152e-20, -1.2104721275e-23, 1.185976e2 * Math.exp(-1.183432e-4 * (t - 126.9686)**2)] },
                    { range: [500, 1372], coeffs: [-1.318058e2, 4.830222e1, -1.646031, 5.464731e-2, -9.650715e-4, 8.802193e-6, -3.110810e-8] }
                ],
                inverse: [
                    { range: [-5.891, 0], coeffs: [0.0, 2.5173462e1, -1.1662878, -1.0833638, -8.9773540e-1, -3.7342377e-1, -8.6632643e-2, -1.0450598e-5, -5.1920577e-6] },
                    { range: [0, 20.644], coeffs: [0.0, 2.508355e1, 7.860106e-2, -2.503131e-1, 8.315270e-2, -1.228034e-2, 9.804036e-4, -4.413030e-6, 1.057734e-8, -1.052755e-11] },
                    { range: [20.644, 54.886], coeffs: [-1.318058e2, 4.830222e1, -1.646031, 5.464731e-2, -9.650715e-4, 8.802193e-6, -3.110810e-8] }
                ],
                tempRange: [-270, 1372],
                emfRange: [-6.458, 54.886],
                tolerances: {
                    class1: (t) => {
                        if (t < -40 || t > 1000) return 'N/A';
                        return t <= 375 ? 1.5 : 0.004 * Math.abs(t);
                    },
                    class2: (t) => {
                        if (t < -40 || t > 1200) return 'N/A';
                        return t <= 333 ? 2.5 : 0.0075 * Math.abs(t);
                    },
                    class3: (t) => {
                        if (t < -200 || t > 40) return 'N/A';
                        return 2.5;
                    }
                }
            },
            E: {
                direct: [
                    { range: [-200, 0], coeffs: [0.0, 5.8665508708e1, 4.5410977124e-2, -7.7998048686e-4, -2.5800160843e-5, -5.9452583057e-7, -9.3214058667e-9, -1.0287605534e-10, -8.0370123621e-13, -4.3979497391e-15, -1.6414776355e-17, -3.9673619516e-20, -5.5827328721e-23, -3.4657842013e-26] },
                    { range: [0, 1000], coeffs: [0.0, 5.8665508710e1, 4.5032275582e-2, 2.8908407212e-5, -3.3056896652e-7, 6.5024403270e-10, -6.4066656604e-13, 3.8438522598e-16, -1.2260341300e-19, 1.6053048166e-23, 1.185976e2 * Math.exp(-1.183432e-4 * (t - 126.9686)**2)] }
                ],
                inverse: [
                    { range: [-8.825, 0], coeffs: [0.0, 1.6977288e1, -4.3514970e-1, -1.5859697e-1, -9.2502871e-2, -2.6084314e-2, -4.1360199e-3, -3.4034030e-4, -1.1564890e-5] },
                    { range: [0, 76.373], coeffs: [0.0, 1.7057035e1, -2.3301759e-1, 6.5435585e-3, -7.3562749e-5, -1.7896001e-6, 8.4036165e-8, -1.3735879e-9, 1.0629823e-11, -3.2447087e-14] }
                ],
                tempRange: [-270, 1000],
                emfRange: [-9.835, 76.373],
                tolerances: {
                    class1: (t) => {
                        if (t < -40 || t > 800) return 'N/A';
                        return t <= 375 ? 1.5 : 0.004 * Math.abs(t);
                    },
                    class2: (t) => {
                        if (t < -40 || t > 900) return 'N/A';
                        return t <= 333 ? 2.5 : 0.0075 * Math.abs(t);
                    },
                    class3: (t) => {
                        if (t < -200 || t > 40) return 'N/A';
                        return 2.5;
                    }
                }
            },
            T: {
                direct: [
                    { range: [-200, 0], coeffs: [0.0, 3.8748106364e1, 4.4194434347e-2, -6.7549233144e-4, -2.0032973554e-5, 8.057047e-7, -2.8511853e-8, 5.607204e-10, -5.2186848e-12] },
                    { range: [0, 400], coeffs: [0.0, 3.8748106364e1, 3.3292227880e-2, 2.0618243404e-4, -2.1882256846e-6, 1.0996880928e-8, -3.0815758772e-11, 4.5479135290e-14, -2.7754911967e-17] }
                ],
                inverse: [
                    { range: [-5.603, 0], coeffs: [0.0, 2.5949192e1, -1.4420329e-1, 5.5151538, -1.5905623e1, 2.823159e1, -2.8763005e1, 1.994710, -5.638203e-1] },
                    { range: [0, 20.872], coeffs: [0.0, 2.592800e1, -7.602961e-1, 4.637791e-2, -2.608336e-3, 6.048144e-5, -5.184475e-7] }
                ],
                tempRange: [-270, 400],
                emfRange: [-5.603, 20.872],
                tolerances: {
                    class1: (t) => {
                        if (t < -40 || t > 350) return 'N/A';
                        return t <= 125 ? 0.5 : 0.004 * Math.abs(t);
                    },
                    class2: (t) => {
                        if (t < -40 || t > 350) return 'N/A';
                        return t <= 133 ? 1 : 0.0075 * Math.abs(t);
                    },
                    class3: (t) => {
                        if (t < -200 || t > 40) return 'N/A';
                        return 1;
                    }
                }
            },
            R: {
                direct: [
                    { range: [-50, 1064.18], coeffs: [0.0, 5.28961729765, 1.39166589782e-2, -2.38855693017e-5, 3.56916001063e-8, -4.62347666298e-11, 5.00777441034e-14, -3.73105886191e-17, 1.57716482367e-20, -2.81038625251e-24] },
                    { range: [1064.18, 1664.5], coeffs: [2.95157925316e3, -2.52061251332e3, 9.9477323, -1.7027663e-1, 1.43033468e-3, -4.73886084e-6] },
                    { range: [1664.5, 1768.1], coeffs: [1.185976e2, -1.183432e-4 * (t - 126.9686)**2] } // exponential term for high
                ],
                inverse: [
                    { range: [-0.226, 1.923], coeffs: [0.0, 1.889138e2, -9.3835290e1, 1.3068619e2, -2.2703580e2, 3.5145659e2, -3.8953900e2, 2.8239471e2, -1.2607281e2, 3.1353611e1, -3.3187769] },
                    { range: [1.923, 11.361], coeffs: [0.0, 1.334584505e2, -1.472644573e2, 1.844024844e2, -1.513637513e2, 8.08668845e1, -2.503004725e1, 4.65256e-1, -3.244708e-3] },
                    { range: [11.361, 19.739], coeffs: [0.0, 1.889138e2, -9.3835290e1, 1.3068619e2, -2.2703580e2, 3.5145659e2, -3.8953900e2, 2.8239471e2, -1.2607281e2, 3.1353611e1, -3.3187769] }, // adjust
                    { range: [19.739, 21.103], coeffs: [1.90027820e4, -1.94035367e2, 6.6078836, -7.5291522e-2, 3.6304898e-4, -8.754904e-8] }
                ],
                tempRange: [-50, 1768],
                emfRange: [-0.226, 21.103],
                tolerances: {
                    class1: (t) => {
                        if (t < 0 || t > 1600) return 'N/A';
                        return t <= 1100 ? 1 : 1 + 0.003 * (t - 1100);
                    },
                    class2: (t) => {
                        if (t < 0 || t > 1600) return 'N/A';
                        return t <= 600 ? 1.5 : 0.0025 * t;
                    },
                    class3: null
                }
            },
            S: {
                direct: [
                    { range: [-50, 1064.18], coeffs: [0.0, 5.4031330863, 1.3259430485e-2, -2.2523207475e-5, 3.0108106180e-8, -3.7383768415e-11, 3.33253258485e-14, -1.8994951336e-17, 6.0863245607e-21, -8.466099353e-25] },
                    { range: [1064.18, 1664.5], coeffs: [1.5409630494e3, -1.50179125117e3, 5.1196552, -7.1632216e-3, 5.333875e-6, -2.045598e-9, 3.95385252e-13] },
                    { range: [1664.5, 1768.1], coeffs: [1.185976e2, -1.183432e-4 * (t - 126.9686)**2] }
                ],
                inverse: [
                    { range: [-0.235, 1.874], coeffs: [0.0, 1.84949460e2, -8.00504062e1, 1.02237430e2, -1.52248592e2, 1.88821343e2, -1.59085941e2, 8.23027880e1, -2.34181944e1, 2.79786260] },
                    { range: [1.874, 11.95], coeffs: [0.0, 1.291507177e2, -1.466298863e2, 1.534713402e2, -3.145945973e1, -4.163257839e1, 3.187963771e1, -1.291637500e1, 2.183475087e-1, -1.112173296e-3] },
                    { range: [11.95, 18.503], coeffs: [0.0, 1.84949460e2, -8.00504062e1, 1.02237430e2, -1.52248592e2, 1.88821343e2, -1.59085941e2, 8.23027880e1, -2.34181944e1, 2.79786260] }, // adjust
                    { range: [18.503, 18.693], coeffs: [3.36298318e4, -2.7724356e2, 7.25646, -7.818431e-2, 3.2009785e-4, -6.71204e-8] }
                ],
                tempRange: [-50, 1768],
                emfRange: [-0.235, 18.693],
                tolerances: {
                    class1: (t) => {
                        if (t < 0 || t > 1600) return 'N/A';
                        return t <= 1100 ? 1 : 1 + 0.003 * (t - 1100);
                    },
                    class2: (t) => {
                        if (t < 0 || t > 1600) return 'N/A';
                        return t <= 600 ? 1.5 : 0.0025 * t;
                    },
                    class3: null
                }
            },
            B: {
                direct: [ // μV
                    { range: [0, 630.615], coeffs: [0.0, -2.4650818346e-1, 5.9040421171e-3, -1.3257931636e-6, 1.5668291901e-9, -1.6944529240e-12, 6.2990347094e-16] },
                    { range: [630.615, 1820], coeffs: [0.0, -3.8938168621e3, 2.8571747470e1, -8.4885104785e-2, 1.5785280164e-4, -1.6835344864e-7, 1.1109794013e-10, -4.4515431033e-14, 9.8975640821e-18, -9.3791330289e-22] }
                ],
                inverse: [ // mV to °C
                    { range: [0.291, 2.431], coeffs: [9.8423321e1, 6.997150e2, -8.4765304e2, 1.0052644e3, -8.3345952e2, 4.5508542e2, -1.5523037e2, 2.988675e1, -2.4742860] },
                    { range: [2.431, 13.820], coeffs: [2.1315071e2, 2.8510504e2, -5.2742887e1, 9.9160804, -1.2965303, 1.1195870e-1, -6.0625199e-3, 1.8661696e-4, -2.4878585e-6] }
                ],
                tempRange: [0, 1820],
                emfRange: [0, 13.820],
                tolerances: {
                    class1: () => 'N/A',
                    class2: (t) => {
                        if (t < 600 || t > 1700) return 'N/A';
                        return 0.0025 * t;
                    },
                    class3: (t) => {
                        if (t < 600 || t > 1820) return 'N/A';
                        return t <= 800 ? 4 : 0.005 * t;
                    }
                }
            }
        };

        function getType() {
            return document.querySelector('input[name="type"]:checked').value;
        }

        function calculatePolynomial(coeffs, x) {
            return coeffs.reduce((acc, c, i) => acc + c * Math.pow(x, i), 0);
        }

        function findRange(ranges, value, isEmf = false) {
            for (let r of ranges) {
                const rRange = isEmf ? r.range.map(v => v * 1000) : r.range; // if inverse range in mV, convert to μV
                if (value >= rRange[0] && value <= rRange[rRange.length - 1]) {
                    return r;
                }
            }
            return null;
        }

        function calculateEmf() {
            const type = getType();
            const data = coefficients[type];
            let tHot = parseFloat(document.getElementById('inputTemp').value);
            const tCold = parseFloat(document.getElementById('coldTemp').value);
            if (isNaN(tHot) || isNaN(tCold) || tHot < data.tempRange[0] || tHot > data.tempRange[1] || tCold < 0 || tCold > 60) {
                alert('输入值无效或超出范围');
                return;
            }

            const rangeHot = findRange(data.direct, tHot);
            const rangeCold = findRange(data.direct, tCold);
            if (!rangeHot || !rangeCold) {
                alert('温度超出多项式范围');
                return;
            }

            let emfHot = calculatePolynomial(rangeHot.coeffs, tHot);
            let emfCold = calculatePolynomial(rangeCold.coeffs, tCold);
            let emf = (emfHot - emfCold) / 1000; // to mV

            const tol1 = data.tolerances.class1(tHot);
            const tol2 = data.tolerances.class2(tHot);
            const tol3 = data.tolerances.class3 ? data.tolerances.class3(tHot) : 'N/A';

            const mat = materials[type];

            document.getElementById('result').innerHTML = `
                <h3>计算结果:</h3>
                <p>电偶类型: ${type}型</p>
                <p class="material">电偶来历: 正极 (${mat.positive}) / 负极 (${mat.negative})</p>
                <p>电动势: ${emf.toFixed(3)}mV</p>
                <p>1级公差: ±${tol1 !== 'N/A' ? tol1.toFixed(1) + '°C' : '-°C'}</p>
                <p>2级公差: ±${tol2 !== 'N/A' ? tol2.toFixed(1) + '°C' : '-°C'}</p>
                <p>3级公差: ±${tol3 !== 'N/A' ? tol3.toFixed(1) + '°C' : '-°C'}</p>
                <p>温度: ${tHot}°C</p>
                <p>1级公差: ±${tol1 !== 'N/A' ? tol1.toFixed(1) + '°C' : '-°C'}</p>
                <p>2级公差: ±${tol2 !== 'N/A' ? tol2.toFixed(1) + '°C' : '-°C'}</p>
                <p>3级公差: ±${tol3 !== 'N/A' ? tol3.toFixed(1) + '°C' : '-°C'}</p>
            `;
        }

        function calculateTemp() {
            const type = getType();
            const data = coefficients[type];
            let emfMeasured = parseFloat(document.getElementById('inputEmf').value) * 1000; // mV to μV
            const tCold = parseFloat(document.getElementById('coldTemp').value);
            if (isNaN(emfMeasured) || isNaN(tCold) || emfMeasured / 1000 < data.emfRange[0] || emfMeasured / 1000 > data.emfRange[1] || tCold < 0 || tCold > 60) {
                alert('输入值无效或超出范围');
                return;
            }

            const rangeCold = findRange(data.direct, tCold);
            if (!rangeCold) {
                alert('冷端温度超出范围');
                return;
            }
            const emfCold = calculatePolynomial(rangeCold.coeffs, tCold);
            const emfTotal = emfMeasured + emfCold;

            const rangeInverse = findRange(data.inverse, emfTotal / 1000, true); // range in mV
            let tHot;
            if (rangeInverse) {
                tHot = calculatePolynomial(rangeInverse.coeffs, emfTotal / 1000);
            } else {
                // Fallback to binary search if no inverse
                let low = data.tempRange[0];
                let high = data.tempRange[1];
                for (let i = 0; i < 100; i++) {
                    const mid = (low + high) / 2;
                    const midRange = findRange(data.direct, mid);
                    const midEmf = calculatePolynomial(midRange.coeffs, mid);
                    if (midEmf < emfTotal) low = mid;
                    else high = mid;
                    if (high - low < 0.001) break;
                }
                tHot = (low + high) / 2;
            }

            const tol1 = data.tolerances.class1(tHot);
            const tol2 = data.tolerances.class2(tHot);
            const tol3 = data.tolerances.class3 ? data.tolerances.class3(tHot) : 'N/A';

            const mat = materials[type];

            document.getElementById('result').innerHTML = `
                <h3>计算结果:</h3>
                <p>电偶类型: ${type}型</p>
                <p class="material">电偶来历: 正极 (${mat.positive}) / 负极 (${mat.negative})</p>
                <p>电动势: ${(emfMeasured / 1000).toFixed(3)}mV</p>
                <p>1级公差: ±${tol1 !== 'N/A' ? tol1.toFixed(1) + '°C' : '-°C'}</p>
                <p>2级公差: ±${tol2 !== 'N/A' ? tol2.toFixed(1) + '°C' : '-°C'}</p>
                <p>3级公差: ±${tol3 !== 'N/A' ? tol3.toFixed(1) + '°C' : '-°C'}</p>
                <p>温度: ${tHot.toFixed(2)}°C</p>
                <p>1级公差: ±${tol1 !== 'N/A' ? tol1.toFixed(1) + '°C' : '-°C'}</p>
                <p>2级公差: ±${tol2 !== 'N/A' ? tol2.toFixed(1) + '°C' : '-°C'}</p>
                <p>3级公差: ±${tol3 !== 'N/A' ? tol3.toFixed(1) + '°C' : '-°C'}</p>
            `;
        }
    </script>
</body>
</html>
